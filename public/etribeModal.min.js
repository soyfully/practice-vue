
export default function EtribeModal(opt) {
    var _this = this;
    /*
        iOpt {
            selector :  object,
            scrollLock : bool,
            useDimm : bool,
            dimmCss : string,
            selectDimm : object,
            hideOnClick? : boolean;
        }
    */
    this._body = document.querySelector('body');
    opt.selector.classList.add('etribe-modal-center-wrap');
    var setScrollLock = (Object.prototype.hasOwnProperty.call(opt, "scrollLock") && opt.scrollLock) ? true : false;
    var setUseDimm = (Object.prototype.hasOwnProperty.call(opt, "useDimm") && opt.useDimm == false) ? false : true;
    var setDimmCss = (Object.prototype.hasOwnProperty.call(opt, "dimmCss") && opt.dimmCss) ? true : false;
    var setSelectDimm = (Object.prototype.hasOwnProperty.call(opt, "selectDimm") && opt.selectDimm) ? true : false;
    var setHideOnClick = (Object.prototype.hasOwnProperty.call(opt, "hideOnClick") && opt.hideOnClick) ? true : false;
    this._center();
    window.addEventListener('resize', function () {
        var etribe_modal = document.querySelector('.etribe-modal-center-wrap');
        if (etribe_modal) {
            _this._center();
        }
    });
    if (setScrollLock) {
        this._scrollLockFunc(opt.selector);
    }
    if (setUseDimm) {
        this._setUseDimm();
    }
    if (setDimmCss && setUseDimm) {
        this._setDimmCss(opt.dimmCss);
    }
    if (setSelectDimm) {
        this._selectDimm(opt.selectDimm);
    }
    if (setHideOnClick && (setUseDimm || setSelectDimm)) {
        this._hideOnClick();
    }
}
// hide Modal
EtribeModal.prototype.destroy = function () {
    var etribe_modal = document.querySelector('.etribe-modal-center-wrap');
    // modal hide
    if (etribe_modal) {
        etribe_modal.style.display = 'none';
        etribe_modal.classList.remove('etribe-modal-center-wrap');
        // scroll unlock 
        this._unbindEvent(etribe_modal, 'scroll touchmove mousewheel', this._eventBubbling);
        this._body.style.overflow = '';
        // hide select dimm
        this._hideDimm();
        // destroy create dimm
        this._destroyDimm();
    }
};
// position center 
EtribeModal.prototype._center = function () {
    var etribe_modal = document.querySelector('.etribe-modal-center-wrap');
    etribe_modal.style.cssText = etribe_modal.style.cssText + 'display:block; position:absolute; z-index: 100';
    etribe_modal.style.top = Math.max(0, ((window.innerHeight - etribe_modal.clientHeight) / 2) + window.pageYOffset) + "px";
    etribe_modal.style.left = Math.max(0, ((window.innerWidth - etribe_modal.clientWidth) / 2) + window.pageXOffset) + "px";
};
// scroll Lock
EtribeModal.prototype._scrollLockFunc = function (selector) {
    this._bindEvent(selector, 'scroll touchmove mousewheel', this._eventBubbling);
    this._body.style.cssText = 'overflow:hidden';
};
EtribeModal.prototype._eventBubbling = function (e) {
    e.preventDefault();
    e.stopPropagation();
    return false;
};
EtribeModal.prototype._bindEvent = function (el, events, func) {
    events.split(' ').forEach(function (evt) {
        el.addEventListener(evt, func);
    });
};
// scroll Unlock
EtribeModal.prototype._unbindEvent = function (el, events, func) {
    events.split(' ').forEach(function (evt) {
        el.removeEventListener(evt, func);
    });
};
// use Dimm
EtribeModal.prototype._setUseDimm = function () {
    var _dimDiv = this._createDiv('<div class="etribe-modal-dimm" style="width: 100%; height:100%; display:block; position: absolute; z-index: 99; top: 0; left: 0; background-color:black; opacity:0.6 "></div>');
    var _dimm = document.querySelector('.etribe-modal-dimm');
    if (!_dimm) {
        this._body.appendChild(_dimDiv);
    }
};
// Dimm css
EtribeModal.prototype._setDimmCss = function (dimmCss) {
    var _dimm = document.querySelector('.etribe-modal-dimm');
    _dimm.style.cssText = _dimm.style.cssText + ';' + dimmCss;
};
EtribeModal.prototype._createDiv = function (dimm) {
    var _emptyDiv = document.createElement('div');
    _emptyDiv.innerHTML = dimm;
    return _emptyDiv.firstChild;
};
// select Dimm
EtribeModal.prototype._selectDimm = function (selectDimm) {
    selectDimm.classList.add('etribe-modal-dimm-user');
    selectDimm.style.display = 'block';
};
// hide select Dimm
EtribeModal.prototype._hideDimm = function () {
    var _userDimm = document.querySelector('.etribe-modal-dimm-user');
    if (_userDimm) {
        _userDimm.style.display = 'none';
        _userDimm.classList.remove('etribe-modal-dimm-user');
    }
};
// destroy use Dimm
EtribeModal.prototype._destroyDimm = function () {
    var _dimm = document.querySelector('.etribe-modal-dimm');
    if (_dimm) {
        _dimm.parentNode.removeChild(_dimm);
    }
};
// hide modal after dimm click
EtribeModal.prototype._hideOnClick = function () {
    var _this = this;
    var _dimm = document.querySelector('.etribe-modal-dimm');
    var _userDimm = document.querySelector('.etribe-modal-dimm-user');
    var _clickDimm = _dimm || _userDimm;
    _clickDimm.addEventListener('click', function () {
        _this.destroy();
    });
};